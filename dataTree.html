<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Load d3.js -->
        <script src="./build/js/d3.v4.js"></script>
    
    <title>Data Trees</title>
</head>
<body>

    <style>
        svg:hover{
        }
        .color{
            fill:#004176;
        }
        .color:hover{
            fill: rgb(233, 115, 72);
            pointer-events: all;
            stroke: 2px;
            color: #004176;
        }
        img.header{
            width:100%;
        }
        .page-title{
            margin-bottom: 3px;
            font-family: Roboto, "Open Sans", sans-serif;
            font-size: 24px;
        }
        image{
        }
        image:hover{
            opacity:1;
        }
        

    </style>


    <img src="./build/imgs/header.jpg" alt="" class="header">
    <h1 class="page-title"><em>JACC</em> Journals Most Read Articles From 2021</h1>
    <div id="top10treeMap"></div>
    
    
    <script>
    function redraw(){
  // set the dimensions and margins of the graph
  var margin = {top: 10, right: 10, bottom: 10, left: 10},
          width = window.innerWidth*.75 - margin.left - margin.right,
          height = window.innerHeight*.75 - margin.top - margin.bottom;
        
        // append the svg object to the body of the page
        var svg = d3.select("#top10treeMap")
        .append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");
        
        // Read data
        d3.csv('./data/topArticles.csv', function(data) {
        
          // stratify the data: reformatting for d3.js
          var root = d3.stratify()
            .id(function(d) { return d.BriefTitle; })   // Name of the entity (column name is name in csv)
            .parentId(function(d) { return d.parent; })   // Name of the parent (column name is parent in csv)
            (data);
          root.sum(function(d) { return +d.usage })   // Compute the numeric value for each entity
        
          // Then d3.treemap computes the position of each element of the hierarchy
          // The coordinates are added to the root object above
          d3.treemap()
            .size([width, height])
            .padding(4)
            (root)
        
       // console.log(root.leaves())
          // use this information to add rectangles:
          svg
            .selectAll("rect")
            .data(root.leaves())
            .enter()
            .append('a')
            .attr("xlink:href", function(d){return d.data.link})
            .append("rect")
              .attr('x', function (d) { return d.x0; })
              .attr('y', function (d) { return d.y0; })
              .style('data', function (d) {return d.usage})
              .attr('width', function (d) { return d.x1 - d.x0; })
              .attr('height', function (d) { return d.y1 - d.y0; })
              .attr('class', 'color')

            var imgs = svg.selectAll("image").data(root.leaves());
            imgs.enter()
            .append('a')
        .attr("xlink:href", function(d){return d.data.link})
            .append("svg:image")
            .attr("xlink:href",function(d){return d.data.img}) //"https://www.w3.org/comm/assets/icons/handshake.png")
            .attr("x", function(d){ console.log(d); return d.x0})    // +10 to adjust position (more right)
            .attr("y", function(d){ return d.y0})    // +20 to adjust position (lower)
            .attr('width', function (d) { return (d.x1 - d.x0)/2; })
            .attr('height', function (d) { return (d.y1 - d.y0)/2; })
            .attr('opacity', ".5")

// root.children.forEach(child => console.log(child.data.BriefTitle ));
  
        
          // and to add the text labels
        //  svg
        //     .selectAll("text")
        //     .data(root.leaves())
        //     .enter()
        //     .append('a')
        //     .attr("xlink:href", function(d){return d.data.link})
        //     .append("text")
        //       .attr("x", function(d){ return d.x0+10})    // +10 to adjust position (more right)
        //       .attr("y", function(d){ return d.y0+20})    // +20 to adjust position (lower)
        //       .text(function(d) { return d.data.BriefTitle.split(" ").join(" "); }) //  /(?=[A-Z][^A-Z])/g); })
        //       .attr("font-size", "1.2em")//function(d,i){ return((root.children.length-i)*.2).toFixed(1)+"em"})//return (i.length-i)*10})
        //       .attr("fill", "white")


        svg
            .selectAll("text")
            .data(root.leaves())
            .enter()
// .append("clip-path", function(d) { return "url(#clip-" + d.data.BriefTitle + ")"; })
            .append("text")
            .attr("x", function(d){ return d.x0+10})    // +10 to adjust position (more right)
            .attr("y", function(d){ return d.y0+20})    // +20 to adjust position (lower)
            .attr("font-size", "1.2em")//function(d,i){ return((root.children.length-i)*.2).toFixed(1)+"em"})//return (i.length-i)*10})
            .attr("fill", "white")
            .selectAll("tspan")
            .data(function(d) { return d.data.BriefTitle.split(" ") }) //d.data.BriefTitle.split(/(?=[A-Z][^A-Z])/g) })
            .enter().append("tspan")
           .attr("dx", function(d,i){ return this.parentNode.getAttribute('x')*-i})    // +10 to adjust position (more right)
            .attr("dy", function(d){  return 15}) //console.log( this.parentNode.getBoundingClientRect());
            .text(function(d) { return d; });
        })
    }
    redraw();
    window.addEventListener('resize', function(){document.getElementById('top10treeMap').innerHTML= ""; redraw()});
      
        </script>  
</body>
</html>