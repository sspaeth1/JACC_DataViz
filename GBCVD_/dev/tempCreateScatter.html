<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- <script src="./js/d3v7.js"></script> -->
    <script src="../dev/js/d3v4_13.js"></script>


    <script src="https://pagecdn.io/lib/billboardjs/3.5.1/billboard.pkgd.min.js" type="text/javascript"></script>

    <link rel="stylesheet" href="./css/billboard.css">
    <link rel="stylesheet" href="./css/graph.min.css">
</head>

<body>

    <div id="scatterPlot"></div>
    <div id="my_dataviz"></div>
</body>

<script>
    /*var chart = bb.generate({
        data: {

            columns: [
                [
                    "Andean Latin America: Colombia",
                    101.08
                ],
                [
                    "Andean Latin America: Colombia_x",
                    66.21
                ],
                [
                    "Andean Latin America: Ecuador",
                    191.31
                ],
                [
                    "Andean Latin America: Ecuador_x",
                    59.9
                ],
                [
                    "Andean Latin America: Peru",
                    163.67
                ],
                [
                    "Andean Latin America: Peru_x",
                    66.1
                ],
                [
                    "Australasia: Andorra",
                    125.24
                ],
                [
                    "Australasia: Andorra_x",
                    84.94
                ],
                [
                    "Australasia: New Zealand",
                    97.85
                ],
                [
                    "Australasia: New Zealand_x",
                    84.43
                ],
                [
                    "Caribbean: Bahamas",
                    246.43
                ],
                [
                    "Caribbean: Bahamas_x",
                    74.99
                ],
                [
                    "Caribbean: Barbados",
                    235.62
                ],
                [
                    "Caribbean: Barbados_x",
                    80.5
                ]
            ],

            [
                ["setosa_x", 3.5, 3, 3.2, 3.1, 3.6, 3.9, 3.4, 3.4, 2.9, 3.1, 3.7, 3.4, 3, 3, 4, 4.4, 3.9, 3.5, 3.8, 3.8, 3.4, 3.7, 3.6,
                    3.3, 3.4, 3, 3.4, 3.5, 3.4, 3.2, 3.1, 3.4, 4.1, 4.2, 3.1, 3.2, 3.5, 3.6, 3, 3.4, 3.5, 2.3, 3.2, 3.5, 3.8, 3, 3.8, 3.2,
                    3.7, 3.3],
                ["versicolor_x", 3.2, 3.2, 3.1, 2.3, 2.8, 2.8, 3.3, 2.4, 2.9, 2.7, 2, 3, 2.2, 2.9, 2.9, 3.1, 3, 2.7, 2.2, 2.5, 3.2, 2.8,
                    2.5, 2.8, 2.9, 3, 2.8, 3, 2.9, 2.6, 2.4, 2.4, 2.7, 2.7, 3, 3.4, 3.1, 2.3, 3, 2.5, 2.6, 3, 2.6, 2.3, 2.7, 3, 2.9, 2.9,
                    2.5, 2.8],
                ["setosa", 0.2, 0.2, 0.2, 0.2, 0.2, 0.4, 0.3, 0.2, 0.2, 0.1, 0.2, 0.2, 0.1, 0.1, 0.2, 0.4, 0.4, 0.3, 0.3, 0.3, 0.2, 0.4,
                    0.2, 0.5, 0.2, 0.2, 0.4, 0.2, 0.2, 0.2, 0.2, 0.4, 0.1, 0.2, 0.2, 0.2, 0.2, 0.1, 0.2, 0.2, 0.3, 0.3, 0.2, 0.6, 0.4, 0.3,
                    0.2, 0.2, 0.2, 0.2],
                ["versicolor", 1.4, 1.5, 1.5, 1.3, 1.5, 1.3, 1.6, 1, 1.3, 1.4, 1, 1.5, 1, 1.4, 1.3, 1.4, 1.5, 1, 1.5, 1.1, 1.8, 1.3,
                    1.5, 1.2, 1.3, 1.4, 1.4, 1.7, 1.5, 1, 1.1, 1, 1.2, 1.6, 1.5, 1.6, 1.5, 1.3, 1.3, 1.3, 1.2, 1.4, 1.2, 1, 1.3, 1.2, 1.3,
                    1.3, 1.1, 1.3]
            ],
            type: "scatter", // for ESM specify as: scatter()
        },

        bindto: "#scatterPlot"
    });
    */
</script>

<script src="../data/cleaned/sdi.js"></script>

<script>
    // set the dimensions and margins of the graph
    var margin = { top: 10, right: 30, bottom: 30, left: 60 },
        width = 460 - margin.left - margin.right,
        height = 250 - margin.top - margin.bottom;

    // append the svg object to the body of the page
    var svg = d3.select("#my_dataviz")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

    //Read the data
    d3.csv("../data/cleaned/SDI_plot_mortVsSDI.csv", function (data) {
        console.log(data)
        // Add X axis
        var x = d3.scaleLinear()
            .domain([0, 100])
            .range([0, width]);
        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x));

        // Add Y axis
        var y = d3.scaleLinear()
            .domain([0, 700])
            .range([height, 0]);
        svg.append("g")
            .call(d3.axisLeft(y));


        var tooltip = d3.select("#my_dataviz")
            .append("div")
            .style("opacity", 0)
            .attr("class", "tooltip")
            .style("background-color", "white")
            .style("border", "solid")
            .style("border-width", "1px")
            .style("border-radius", "5px")
            .style("padding", "10px")

        // Add X axis label:
        svg.append("text")
            .attr("text-anchor", "end")
            .attr("x", width)
            .attr("y", height + margin.top + 20)
            .text("Socio-Demographic Index");

        // Y axis label:
        svg.append("text")
            .attr("text-anchor", "end")
            .attr("transform", "rotate(-90)")
            .attr("y", -margin.left + 20)
            .attr("x", -margin.top)
            .text("Mortalitu Rate per 100,000")

        var mouseover = function (d) {
            tooltip
                .style("opacity", 1)
            // console.log(this)
        }

        var mousemove = function (d, i) {
            tooltip
                .html("<b>" + SDIkey[i] + "</b> | Mortality: " + d.Mort + ",  SDI: " + d.SDI)
                .style("left", (d3.mouse(this)[0] + 90) + "px") // It is important to put the +90: other wise the tooltip is exactly where the point is an it creates a weird effect
                .style("top", (d3.mouse(this)[1]) + "px")
        }

        // A function that change this tooltip when the leaves a point: just need to set opacity to 0 again
        var mouseleave = function (d) {
            tooltip
                .transition()
                .duration(200)
                .style("opacity", 0)
        }

        // Add dots
        svg.append('g')
            .selectAll("dot")
            .data(data.filter(function (d, i) { return i < 50 })) // the .filter part is just to keep a few dots on the chart, not all of them
            .enter()
            .append("circle")
            .attr("cx", function (d) { return x(d.SDI); })
            .attr("cy", function (d) { return y(d.Mort); })
            .attr("r", 5)
            .style("fill", "#69b3a2")
            .style("opacity", 0.3)
            .style("stroke", "white")
            .on("mouseover", mouseover)
            .on("mousemove", mousemove)
            .on("mouseleave", mouseleave)
    })
</script>

</html>