<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div id="locationMetricSelection"></div>
    <div id="dummyData"></div>

</body>

<script src="https://pagecdn.io/lib/billboardjs/3.5.1/billboard.pkgd.min.js" type="text/javascript"></script>
<link rel="stylesheet" href="./css/billboard.css">

<script src="../data/IN/IHME_GBD_REGION_CVD_1990_2021_DISEASE_Y2022M12D09.js"></script>
<script>

    let selected_region_name = "Central Europe", //"Australasia",
        selected_Cause_name = "Cardiovascular diseases",
        selected_measure_name = "Deaths",
        selected_metric_name = "Rate",
        selected_sex = "Both"
    selected_age_group_name = "Age-standardized";

    MULTIPLY_RATE = 100000;

    let causeNameItems = Array.from(new Set(diseaseData.map(item => item.cause_name)))
    let regionLocations = Array.from(new Set(diseaseData.map(item => item.region_name === selected_region_name && item.region_name != item.location_name ? item.location_name : null)))
    let regionFiltered = diseaseData.filter(item => item.region_name === selected_region_name && item.measure_name === selected_measure_name && item.region_name != item.location_name ? item.location_name : null)

    // let arr = regionLocations.forEach(r => diseaseData.map(item => r.push(item.Daly)))
    ////filter
    console.table("diseaseData: regionFiltered = ", Array.from(regionFiltered))

    let arr = [], arrLocations = []


    /////// create arr:   [location_name, disease_cause.val, disease_cause.val, disease_cause.val, disease_cause.val ... ]
    regionLocations.forEach(
        (regionNameIsolated, i) => {
            if (arrLocations[i] === undefined) {
                arrLocations[i] = []
            }

            regionFiltered.map(item => {
                if (item.location_name === regionNameIsolated && item.measure_name === "Deaths") {
                    let itemVal = item.val * MULTIPLY_RATE
                    arrLocations[i].push(parseFloat(itemVal.toFixed(2)))
                }
            });
            arrLocations[i].unshift(regionNameIsolated)
        })

    arrLocations = Object.values(arrLocations)
    arrLocations.shift()
    console.log('arrLocations', arrLocations)
    /////////

    let regionLocationArr = Array.from(regionLocations)
    regionLocationArr.slice(1, regionLocationArr.length)

    ////// create arr: [disease_cause.name,location_name.val, location_name.val]
    causeNameItems.forEach((causeItem, i) => {

        if (arr[i] === undefined) {
            arr[i] = []
        }
        regionFiltered.map(item => {
            // console.table(item)

            if (item.cause_name != causeItem && item.measure_name === "Deaths" && item.sex === selected_sex) {
                let fixValDec = item.val * MULTIPLY_RATE;
                if (typeof fixValDec === "number") { fixValDec = fixValDec.toFixed(2) }
                arr[i].push(parseFloat(fixValDec))
            }
        })
        arr[i].unshift(causeNameItems[i])
    })
    //////////

    arr = Object.values(arr).map(item => { if (item[0] != null) return item })

    arr.shift()
    // document.querySelector('body').innerHTML = Object.values(arr)

    // console.log("arr", arr)
    console.log("s<<<<<<<<<<<<<<<<<<<", regionLocations)

</script>
<script>
    let dummyData = {
        diseaseNameCountry1dataCountry2data:
            [
                ["diseaseA", 2, 5, 3],
                ["diseaseB", 23, 2, 4]
            ],
        diseaseCategories:
            ["diseaseA", "diseaseB"],
        countries: [
            "country A", "country B", "country C"
        ]
    }
    console.log("dummydata", dummyData)
    console.log("causeNameItems", causeNameItems)




    //////// START  dummy data chart /////////

    var chart = bb.generate({
        // bindto="#dummyData",
        data: {
            columns:
                dummyData.diseaseNameCountry1dataCountry2data,
            type: "bar",
            // groups: [ ["aortic", "hypertensie", "ischmeic "] ]
            groups: [dummyData.diseaseCategories], //[causeNameItems]  //regionLocations
        },
        axis: {
            x: {
                type: "category",
                // categories: ["countryA", "countryB"]
                categories: dummyData.countries,//regionLocationArr,
                tick: {
                    rotate: -75,
                    multiline: false,
                    tooltip: true
                },
                height: 130
            }
        }
    })

    //////// end dummy data chart /////////


    ///////////////// start chart

    var chart = bb.generate({
        bindto: "#locationMetricSelection",
        data: {
            columns:
                arrLocations,
            type: "bar",
            groups: [causeNameItems]
        },
        axis: {
            x: {
                type: "category",
                // categories: ["countryA", "countryB"]
                categories: regionLocations,
                tick: {
                    rotate: -75,
                    multiline: false,
                    tooltip: true
                },
                height: 130
            }
        }
    })
</script>

</html>